<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <title>JKeep-Index</title>
    <!-- default header name is X-CSRF-TOKEN -->
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/plugins/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/plugins/layuiadmin/style/admin.css" media="all">

</head>
<body class="layui-layout-body">

<div id="LAY_app">
    <div class="layui-layout layui-layout-admin">

        <div th:insert="views/layout/header :: header"></div>
        <!-- 侧边菜单 -->
        <div th:insert="views/layout/menu :: menu"></div>
        <!-- 页面标签 -->
        <div th:insert="views/layout/tabs :: tabs"></div>
        <!-- 主体内容 -->
        <div class="layui-body" id="LAY_app_body">
            <div class="layadmin-tabsbody-item layui-show">
                <!--<iframe src="home/console.html" frameborder="0" class="layadmin-iframe"></iframe>
                <iframe class="layadmin-iframe" width="100%" height="100%" src="/login"
                        frameborder="0" data-id="userList.html" seamless></iframe>-->

                Logged user: <span sec:authentication="name">Bob</span><br/>
                Roles: <span sec:authentication="principal.authorities"></span>
                <div sec:authorize="${hasRole('DEFAULT')}">
                    This will only be displayed if authenticated user has a role computed by the controller.
                </div>
            </div>
        </div>

        <!-- 辅助元素，一般用于移动设备下遮罩 -->
        <div class="layadmin-body-shade" layadmin-event="shade"></div>
    </div>
</div>

<script src="/plugins/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '/plugins/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use('index', function () {
        let $ = layui.$, admin = layui.admin,
            _csrf_header = $("meta[name='_csrf_header']").attr("content"),
            _csrf = $("meta[name='_csrf']").attr("content");
        // 登出
        admin.events.logout = function () {
            //执行退出接口
            admin.req({
                url: 'logout',
                type: 'POST',
                headers: {[_csrf_header]: _csrf},
                done: function (res) { //这里要说明一下：done 是只有 response 的 code 正常才会执行。而 succese 则是只要 http 为 200 就会执行
                    //清空本地记录的 token，并跳转到登入页
                    admin.exit(function () {
                        location.href = '/login.html';
                    });
                }
            });
        };

    });
</script>
</body>
</html>


